
var calc_modal = new bootstrap.Modal(document.getElementById('calc_modal'), {backdrop: true, keyboard: false, focus: true});
var exercise_modal = new bootstrap.Modal(document.getElementById('exercise_modal'), {backdrop: true, keyboard: false, focus: true});


document.getElementById('bfp-display').innerHTML = localStorage.getItem('bfp') || '-';
document.getElementById('weight-display').innerHTML = localStorage.getItem('bw') || '-';
document.getElementById('plan-display').innerHTML = localStorage.getItem('plan-verbose') || '-';
document.getElementById('cal-display').innerHTML = localStorage.getItem('cals') || '-';

document.getElementById('carb-display').innerHTML = localStorage.getItem('carbs') || '-';
document.getElementById('fat-display').innerHTML = localStorage.getItem('fats') || '-';
document.getElementById('protein-display').innerHTML = localStorage.getItem('protein') || '-';

loadExercises();

document.getElementById('body-fat-input').value = localStorage.getItem('bfp') || '';
document.getElementById('step-1-form').addEventListener('submit', function(e){
	e.preventDefault();
	var bfp = document.getElementById('body-fat-input').value.replace(/[^\d\.]/g, '');
	if(bfp === '') return alert('Invalid Body Fat Percentage');
	bfp = +bfp;
	if(bfp > 75) return alert('Body Fat Percentage value is too high.');
	localStorage.setItem('bfp', bfp);
	document.getElementById('step-1-card').style.display = 'none';
	document.getElementById('step-2-card').style.display = null;
	document.getElementById('bfp-display').innerHTML = bfp;
});

document.getElementById('body-weight-input').value = localStorage.getItem('bw') || '';
document.getElementById('step-2-form').addEventListener('submit', function(e){
	e.preventDefault();
	var bw = document.getElementById('body-weight-input').value.replace(/[^\d\.]/g, '');
	if(bw === '') return alert('Invalid Body Weight');
	bw = +bw;
	if(bw > 300) return alert('Body Weight too high');
	if(bw < 100) return alert('Body Weight too low');
	localStorage.setItem('bw', bw);
	document.getElementById('weight-display').innerHTML = bw;
	
	document.getElementById('step-2-card').style.display = 'none';
	document.getElementById('step-3-card').style.display = null;
});

[...document.querySelectorAll('.plan-btn')].forEach(btn=>btn.addEventListener('click', function(e){
	e.preventDefault();
	var plan = this.getAttribute('data-plan');
	var plan_verbose = this.innerText.trim();
	localStorage.setItem('plan', plan);
	
	localStorage.setItem('plan-verbose', plan_verbose);
	
	document.getElementById('plan-display').innerHTML = plan_verbose;
	bfp = +localStorage.getItem('bfp');
	weight = +localStorage.getItem('bw');
	var cals = getCalories(plan, bfp, weight);
	document.getElementById('cal-display').innerHTML = cals;
	localStorage.setItem('cals', cals);
	
	var macros = getMacros(plan, cals);
	document.getElementById('carb-display').innerHTML = macros.carbs;
	document.getElementById('fat-display').innerHTML = macros.fats;
	document.getElementById('protein-display').innerHTML = macros.fats;
	
	localStorage.setItem('carbs', macros.carbs);
	localStorage.setItem('fats', macros.fats);
	localStorage.setItem('protein', macros.protein);
	
	document.getElementById('step-3-card').style.display = 'none';
	document.getElementById('step-4-card').style.display = null;
	
	document.getElementById('res-cals').innerHTML = cals;
	document.getElementById('res-carbs').innerHTML = macros.carbs;
	document.getElementById('res-fats').innerHTML = macros.fats;
	document.getElementById('res-protein').innerHTML = macros.protein;
	
	loadExercises();
}));

async function loadExercises(){
	[...document.querySelectorAll('.day-btn')].forEach(btn=>btn.remove());
	var plan_verbose = localStorage.getItem('plan-verbose');
	if(!plan_verbose) return;
	var exercises = await getExercises();
	var btns = document.getElementById('main-btns');
	exercises[plan_verbose].forEach((day, idx)=>{
		if(day.exercises.length){
			btns.insertAdjacentHTML('beforeend', `<button class="btn btn-info day-btn" type="button" data-day='${idx}'>${day.title}</button>`);
		}else{
			btns.insertAdjacentHTML('beforeend', `<button class="btn btn-info day-btn" type="button" disabled>${day.title}</button>`);
		}
	});
	
	document.querySelectorAll('.day-btn').forEach(btn=>btn.addEventListener('click', function(e){
		e.preventDefault();
		var day = this.getAttribute('data-day');
		
		var buffer = exercises[plan_verbose][day].exercises.map(exe=>{
			
			var buf = [];
			if(exe.length > 1){
				buf.push(`<div class="card text-dark bg-warning mb-3">
					<div class="card-header">Superset</div>
					  <div class="card-body">`);
			}
			
			exe.forEach(movement=>{
				var url = movement.demo;
				var digits = url.match(/\/([^\/]+)\/?$/)[1];
				while(digits.indexOf("=") !== -1) digits=digits.split("=")[1];
				
				buf.push(`<div class="card text-dark bg-light mb-3">
					<div class="card-header">${movement.movement}</div>
					  <div class="card-body">

					  <h5 class="card-title">${movement.sets}</h5>
					  <p class="card-text">${movement.notes}</p>
					  
					  <div class='embed-container'><iframe src='https://www.youtube.com/embed/${digits}' frameborder='0' allowfullscreen></iframe></div>
					  
					  </div></div>`);
			});
			
			if(exe.length > 1){
				buf.push(`</div></div>`);
			}
			
			
			return buf.join('');
			
		});
		document.getElementById('exercise_modal_body').innerHTML = buffer.join('');
		exercise_modal.show();
	}));
}

document.getElementById('calc-done').addEventListener('click', function(e){
	e.preventDefault();
	calc_modal.hide();
});

document.getElementById('calc-button').addEventListener('click', function(e){
	e.preventDefault();
	document.getElementById('step-1-card').style.display = null;
	document.getElementById('step-2-card').style.display = 'none';
	document.getElementById('step-3-card').style.display = 'none';
	document.getElementById('step-4-card').style.display = 'none';
	calc_modal.show();
});

getExercises().then(o=>console.log(Object.keys(o)));

function getCalories(plan, bfp, weight){
	var cal_tab;
	switch(plan){
		case 'shred':
			cal_tab = [
				[null,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50],
				[100,1253,1222,1190,1159,1128,1096,1065,1034,1002,971,940,908,877,846,814,783,751,720,689,657,626],
				[105,1324,1291,1258,1225,1192,1159,1126,1093,1060,1027,994,962,929,896,863,830,797,764,731,698,665],
				[110,1394,1360,1325,1291,1256,1222,1187,1153,1118,1084,1049,1015,980,946,911,877,842,808,773,739,704],
				[115,1465,1429,1393,1357,1321,1285,1248,1212,1176,1140,1104,1068,1032,996,960,924,888,852,816,780,744],
				[120,1535,1498,1460,1423,1385,1347,1310,1272,1234,1197,1159,1121,1084,1046,1009,971,933,896,858,820,783],
				[125,1606,1567,1528,1488,1449,1410,1371,1332,1292,1253,1214,1175,1136,1096,1057,1018,979,940,900,861,822],
				[130,1677,1636,1595,1554,1513,1473,1432,1391,1350,1310,1269,1228,1187,1147,1106,1065,1024,984,943,902,861],
				[135,1747,1705,1662,1620,1578,1535,1493,1451,1408,1366,1324,1281,1239,1197,1154,1112,1070,1027,985,943,900],
				[140,1818,1774,1730,1686,1642,1598,1554,1510,1466,1423,1379,1335,1291,1247,1203,1159,1115,1071,1027,984,940],
				[145,1888,1843,1797,1752,1706,1661,1615,1570,1524,1479,1434,1388,1343,1297,1252,1206,1161,1115,1070,1024,979],
				[150,1959,1912,1865,1818,1771,1724,1677,1630,1582,1535,1488,1441,1394,1347,1300,1253,1206,1159,1112,1065,1018],
				[155,2029,1981,1932,1884,1835,1786,1738,1689,1640,1592,1543,1495,1446,1397,1349,1300,1252,1203,1154,1106,1057],
				[160,2100,2050,2000,1949,1899,1849,1799,1749,1699,1648,1598,1548,1498,1448,1397,1347,1297,1247,1197,1147,1096],
				[165,2170,2119,2067,2015,1964,1912,1860,1808,1757,1705,1653,1601,1550,1498,1446,1394,1343,1291,1239,1187,1136],
				[170,2241,2188,2134,2081,2028,1974,1921,1868,1815,1761,1708,1655,1601,1548,1495,1441,1388,1335,1281,1228,1175],
				[175,2312,2257,2202,2147,2092,2037,1982,1927,1873,1818,1763,1708,1653,1598,1543,1488,1434,1379,1324,1269,1214],
				[180,2382,2326,2269,2213,2156,2100,2043,1987,1931,1874,1818,1761,1705,1648,1592,1535,1479,1423,1366,1310,1253],
				[185,2453,2395,2337,2279,2221,2163,2105,2047,1989,1931,1873,1815,1757,1699,1640,1582,1524,1466,1408,1350,1292],
				[190,2523,2464,2404,2345,2285,2225,2166,2106,2047,1987,1927,1868,1808,1749,1689,1630,1570,1510,1451,1391,1332],
				[195,2594,2533,2472,2410,2349,2288,2227,2166,2105,2043,1982,1921,1860,1799,1738,1677,1615,1554,1493,1432,1371],
				[200,2664,2602,2539,2476,2414,2351,2288,2225,2163,2100,2037,1974,1912,1849,1786,1724,1661,1598,1535,1473,1410],
				[205,2735,2671,2606,2542,2478,2414,2349,2285,2221,2156,2092,2028,1964,1899,1835,1771,1706,1642,1578,1513,1449],
				[210,2806,2740,2674,2608,2542,2476,2410,2345,2279,2213,2147,2081,2015,1949,1884,1818,1752,1686,1620,1554,1488],
				[215,2876,2809,2741,2674,2606,2539,2472,2404,2337,2269,2202,2134,2067,2000,1932,1865,1797,1730,1662,1595,1528],
				[220,2947,2878,2809,2740,2671,2602,2533,2464,2395,2326,2257,2188,2119,2050,1981,1912,1843,1774,1705,1636,1567],
				[225,3017,2947,2876,2806,2735,2664,2594,2523,2453,2382,2312,2241,2170,2100,2029,1959,1888,1818,1747,1677,1606],
				[230,3088,3016,2944,2871,2799,2727,2655,2583,2511,2439,2366,2294,2222,2150,2078,2006,1934,1862,1789,1717,1645],
				[235,3158,3085,3011,2937,2864,2790,2716,2642,2569,2495,2421,2348,2274,2200,2127,2053,1979,1905,1832,1758,1684],
				[240,3229,3154,3078,3003,2928,2853,2777,2702,2627,2552,2476,2401,2326,2250,2175,2100,2025,1949,1874,1799,1724],
				[245,3299,3223,3146,3069,2992,2915,2838,2762,2685,2608,2531,2454,2377,2301,2224,2147,2070,1993,1916,1840,1763],
				[250,3370,3292,3213,3135,3056,2978,2900,2821,2743,2664,2586,2508,2429,2351,2272,2194,2116,2037,1959,1880,1802],
				[255,3441,3361,3281,3201,3121,3041,2961,2881,2801,2721,2641,2561,2481,2401,2321,2241,2161,2081,2001,1921,1841],
				[260,3511,3430,3348,3267,3185,3103,3022,2940,2859,2777,2696,2614,2533,2451,2370,2288,2207,2125,2043,1962,1880],
				[265,3582,3499,3415,3332,3249,3166,3083,3000,2917,2834,2751,2668,2584,2501,2418,2335,2252,2169,2086,2003,1920],
				[270,3652,3568,3483,3398,3314,3229,3144,3060,2975,2890,2806,2721,2636,2552,2467,2382,2297,2213,2128,2043,1959],
				[275,3723,3637,3550,3464,3378,3292,3205,3119,3033,2947,2860,2774,2688,2602,2515,2429,2343,2257,2170,2084,1998],
				[280,3793,3706,3618,3530,3442,3354,3267,3179,3091,3003,2915,2827,2740,2652,2564,2476,2388,2301,2213,2125,2037]
			];
			break;
		case 'recomp':
			cal_tab = [
				[null,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50],
				[100,1903,1872,1840,1809,1778,1746,1715,1684,1652,1621,1590,1558,1527,1496,1464,1433,1401,1370,1339,1307,1276],
				[105,1974,1941,1908,1875,1842,1809,1776,1743,1710,1677,1644,1612,1579,1546,1513,1480,1447,1414,1381,1348,1315],
				[110,2044,2010,1975,1941,1906,1872,1837,1803,1768,1734,1699,1665,1630,1596,1561,1527,1492,1458,1423,1389,1354],
				[115,2115,2079,2043,2007,1971,1935,1898,1862,1826,1790,1754,1718,1682,1646,1610,1574,1538,1502,1466,1430,1394],
				[120,2185,2148,2110,2073,2035,1997,1960,1922,1884,1847,1809,1771,1734,1696,1659,1621,1583,1546,1508,1470,1433],
				[125,2256,2217,2178,2138,2099,2060,2021,1982,1942,1903,1864,1825,1786,1746,1707,1668,1629,1590,1550,1511,1472],
				[130,2327,2286,2245,2204,2163,2123,2082,2041,2000,1960,1919,1878,1837,1797,1756,1715,1674,1634,1593,1552,1511],
				[135,2397,2355,2312,2270,2228,2185,2143,2101,2058,2016,1974,1931,1889,1847,1804,1762,1720,1677,1635,1593,1550],
				[140,2468,2424,2380,2336,2292,2248,2204,2160,2116,2073,2029,1985,1941,1897,1853,1809,1765,1721,1677,1634,1590],
				[145,2538,2493,2447,2402,2356,2311,2265,2220,2174,2129,2084,2038,1993,1947,1902,1856,1811,1765,1720,1674,1629],
				[150,2609,2562,2515,2468,2421,2374,2327,2280,2232,2185,2138,2091,2044,1997,1950,1903,1856,1809,1762,1715,1668],
				[155,2679,2631,2582,2534,2485,2436,2388,2339,2290,2242,2193,2145,2096,2047,1999,1950,1902,1853,1804,1756,1707],
				[160,2750,2700,2650,2599,2549,2499,2449,2399,2349,2298,2248,2198,2148,2098,2047,1997,1947,1897,1847,1797,1746],
				[165,2820,2769,2717,2665,2614,2562,2510,2458,2407,2355,2303,2251,2200,2148,2096,2044,1993,1941,1889,1837,1786],
				[170,2891,2838,2784,2731,2678,2624,2571,2518,2465,2411,2358,2305,2251,2198,2145,2091,2038,1985,1931,1878,1825],
				[175,2962,2907,2852,2797,2742,2687,2632,2577,2523,2468,2413,2358,2303,2248,2193,2138,2084,2029,1974,1919,1864],
				[180,3032,2976,2919,2863,2806,2750,2693,2637,2581,2524,2468,2411,2355,2298,2242,2185,2129,2073,2016,1960,1903],
				[185,3103,3045,2987,2929,2871,2813,2755,2697,2639,2581,2523,2465,2407,2349,2290,2232,2174,2116,2058,2000,1942],
				[190,3173,3114,3054,2995,2935,2875,2816,2756,2697,2637,2577,2518,2458,2399,2339,2280,2220,2160,2101,2041,1982],
				[195,3244,3183,3122,3060,2999,2938,2877,2816,2755,2693,2632,2571,2510,2449,2388,2327,2265,2204,2143,2082,2021],
				[200,3314,3252,3189,3126,3064,3001,2938,2875,2813,2750,2687,2624,2562,2499,2436,2374,2311,2248,2185,2123,2060],
				[205,3385,3321,3256,3192,3128,3064,2999,2935,2871,2806,2742,2678,2614,2549,2485,2421,2356,2292,2228,2163,2099],
				[210,3456,3390,3324,3258,3192,3126,3060,2995,2929,2863,2797,2731,2665,2599,2534,2468,2402,2336,2270,2204,2138],
				[215,3526,3459,3391,3324,3256,3189,3122,3054,2987,2919,2852,2784,2717,2650,2582,2515,2447,2380,2312,2245,2178],
				[220,3597,3528,3459,3390,3321,3252,3183,3114,3045,2976,2907,2838,2769,2700,2631,2562,2493,2424,2355,2286,2217],
				[225,3667,3597,3526,3456,3385,3314,3244,3173,3103,3032,2962,2891,2820,2750,2679,2609,2538,2468,2397,2327,2256],
				[230,3738,3666,3594,3521,3449,3377,3305,3233,3161,3089,3016,2944,2872,2800,2728,2656,2584,2512,2439,2367,2295],
				[235,3808,3735,3661,3587,3514,3440,3366,3292,3219,3145,3071,2998,2924,2850,2777,2703,2629,2555,2482,2408,2334],
				[240,3879,3804,3728,3653,3578,3503,3427,3352,3277,3202,3126,3051,2976,2900,2825,2750,2675,2599,2524,2449,2374],
				[245,3949,3873,3796,3719,3642,3565,3488,3412,3335,3258,3181,3104,3027,2951,2874,2797,2720,2643,2566,2490,2413],
				[250,4020,3942,3863,3785,3706,3628,3550,3471,3393,3314,3236,3158,3079,3001,2922,2844,2766,2687,2609,2530,2452],
				[255,4091,4011,3931,3851,3771,3691,3611,3531,3451,3371,3291,3211,3131,3051,2971,2891,2811,2731,2651,2571,2491],
				[260,4161,4080,3998,3917,3835,3753,3672,3590,3509,3427,3346,3264,3183,3101,3020,2938,2857,2775,2693,2612,2530],
				[265,4232,4149,4065,3982,3899,3816,3733,3650,3567,3484,3401,3318,3234,3151,3068,2985,2902,2819,2736,2653,2570],
				[270,4302,4218,4133,4048,3964,3879,3794,3710,3625,3540,3456,3371,3286,3202,3117,3032,2947,2863,2778,2693,2609],
				[275,4373,4287,4200,4114,4028,3942,3855,3769,3683,3597,3510,3424,3338,3252,3165,3079,2993,2907,2820,2734,2648],
				[280,4443,4356,4268,4180,4092,4004,3917,3829,3741,3653,3565,3477,3390,3302,3214,3126,3038,2951,2863,2775,2687]
			];
			break;
		case 'build':
			cal_tab = [
				[null,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50],
				[100,2253,2222,2190,2159,2128,2096,2065,2034,2002,1971,1940,1908,1877,1846,1814,1783,1751,1720,1689,1657,1626],
				[105,2324,2291,2258,2225,2192,2159,2126,2093,2060,2027,1994,1962,1929,1896,1863,1830,1797,1764,1731,1698,1665],
				[110,2394,2360,2325,2291,2256,2222,2187,2153,2118,2084,2049,2015,1980,1946,1911,1877,1842,1808,1773,1739,1704],
				[115,2465,2429,2393,2357,2321,2285,2248,2212,2176,2140,2104,2068,2032,1996,1960,1924,1888,1852,1816,1780,1744],
				[120,2535,2498,2460,2423,2385,2347,2310,2272,2234,2197,2159,2121,2084,2046,2009,1971,1933,1896,1858,1820,1783],
				[125,2606,2567,2528,2488,2449,2410,2371,2332,2292,2253,2214,2175,2136,2096,2057,2018,1979,1940,1900,1861,1822],
				[130,2677,2636,2595,2554,2513,2473,2432,2391,2350,2310,2269,2228,2187,2147,2106,2065,2024,1984,1943,1902,1861],
				[135,2747,2705,2662,2620,2578,2535,2493,2451,2408,2366,2324,2281,2239,2197,2154,2112,2070,2027,1985,1943,1900],
				[140,2818,2774,2730,2686,2642,2598,2554,2510,2466,2423,2379,2335,2291,2247,2203,2159,2115,2071,2027,1984,1940],
				[145,2888,2843,2797,2752,2706,2661,2615,2570,2524,2479,2434,2388,2343,2297,2252,2206,2161,2115,2070,2024,1979],
				[150,2959,2912,2865,2818,2771,2724,2677,2630,2582,2535,2488,2441,2394,2347,2300,2253,2206,2159,2112,2065,2018],
				[155,3029,2981,2932,2884,2835,2786,2738,2689,2640,2592,2543,2495,2446,2397,2349,2300,2252,2203,2154,2106,2057],
				[160,3100,3050,3000,2949,2899,2849,2799,2749,2699,2648,2598,2548,2498,2448,2397,2347,2297,2247,2197,2147,2096],
				[165,3170,3119,3067,3015,2964,2912,2860,2808,2757,2705,2653,2601,2550,2498,2446,2394,2343,2291,2239,2187,2136],
				[170,3241,3188,3134,3081,3028,2974,2921,2868,2815,2761,2708,2655,2601,2548,2495,2441,2388,2335,2281,2228,2175],
				[175,3312,3257,3202,3147,3092,3037,2982,2927,2873,2818,2763,2708,2653,2598,2543,2488,2434,2379,2324,2269,2214],
				[180,3382,3326,3269,3213,3156,3100,3043,2987,2931,2874,2818,2761,2705,2648,2592,2535,2479,2423,2366,2310,2253],
				[185,3453,3395,3337,3279,3221,3163,3105,3047,2989,2931,2873,2815,2757,2699,2640,2582,2524,2466,2408,2350,2292],
				[190,3523,3464,3404,3345,3285,3225,3166,3106,3047,2987,2927,2868,2808,2749,2689,2630,2570,2510,2451,2391,2332],
				[195,3594,3533,3472,3410,3349,3288,3227,3166,3105,3043,2982,2921,2860,2799,2738,2677,2615,2554,2493,2432,2371],
				[200,3664,3602,3539,3476,3414,3351,3288,3225,3163,3100,3037,2974,2912,2849,2786,2724,2661,2598,2535,2473,2410],
				[205,3735,3671,3606,3542,3478,3414,3349,3285,3221,3156,3092,3028,2964,2899,2835,2771,2706,2642,2578,2513,2449],
				[210,3806,3740,3674,3608,3542,3476,3410,3345,3279,3213,3147,3081,3015,2949,2884,2818,2752,2686,2620,2554,2488],
				[215,3876,3809,3741,3674,3606,3539,3472,3404,3337,3269,3202,3134,3067,3000,2932,2865,2797,2730,2662,2595,2528],
				[220,3947,3878,3809,3740,3671,3602,3533,3464,3395,3326,3257,3188,3119,3050,2981,2912,2843,2774,2705,2636,2567],
				[225,4017,3947,3876,3806,3735,3664,3594,3523,3453,3382,3312,3241,3170,3100,3029,2959,2888,2818,2747,2677,2606]
			]
			break;
	}
	if(!cal_tab) return false;
	
	const getClosestIndex = (needle, haystack) => haystack.reduce((acc, curr, idx, arr) => {
		if(curr === null) return acc;
		if(acc === null) return idx;
		var closest_val_diff = Math.abs(arr[acc] - needle);
		var curr_val_diff = Math.abs(curr - needle);
		return closest_val_diff < curr_val_diff ? acc : idx;
	}, null);
	
	var weights = cal_tab.map(a=>a[0]);

	var x = getClosestIndex(bfp, cal_tab[0]);
	var y = getClosestIndex(weight, weights);
	
	return cal_tab[y][x];
}

function getMacros(plan, calories){
	var mac_tab;
	switch(plan){
		case 'shred':
			mac_tab = [
				[900,101.3,67.5,25.0],
				[925,104.1,69.4,25.7],
				[950,106.9,71.3,26.4],
				[975,109.7,73.1,27.1],
				[1000,112.5,75.0,27.8],
				[1025,115.3,76.9,28.5],
				[1050,118.1,78.8,29.2],
				[1075,120.9,80.6,29.9],
				[1100,123.8,82.5,30.6],
				[1125,126.6,84.4,31.3],
				[1150,129.4,86.3,31.9],
				[1175,132.2,88.1,32.6],
				[1200,135.0,90.0,33.3],
				[1225,137.8,91.9,34.0],
				[1250,140.6,93.8,34.7],
				[1275,143.4,95.6,35.4],
				[1300,146.3,97.5,36.1],
				[1325,149.1,99.4,36.8],
				[1350,151.9,101.3,37.5],
				[1375,154.7,103.1,38.2],
				[1400,157.5,105.0,38.9],
				[1425,160.3,106.9,39.6],
				[1450,163.1,108.8,40.3],
				[1475,165.9,110.6,41.0],
				[1500,168.8,112.5,41.7],
				[1525,171.6,114.4,42.4],
				[1550,174.4,116.3,43.1],
				[1575,177.2,118.1,43.8],
				[1600,180.0,120.0,44.4],
				[1625,182.8,121.9,45.1],
				[1650,185.6,123.8,45.8],
				[1675,188.4,125.6,46.5],
				[1700,191.3,127.5,47.2],
				[1725,194.1,129.4,47.9],
				[1750,196.9,131.3,48.6],
				[1775,199.7,133.1,49.3],
				[1800,202.5,135.0,50.0],
				[1825,205.3,136.9,50.7],
				[1850,208.1,138.8,51.4],
				[1875,210.9,140.6,52.1],
				[1900,213.8,142.5,52.8],
				[1925,216.6,144.4,53.5],
				[1950,219.4,146.3,54.2],
				[1975,222.2,148.1,54.9],
				[2000,225.0,150.0,55.6],
				[2025,227.8,151.9,56.3],
				[2050,230.6,153.8,56.9],
				[2075,233.4,155.6,57.6],
				[2100,236.3,157.5,58.3],
				[2125,239.1,159.4,59.0],
				[2150,241.9,161.3,59.7],
				[2175,244.7,163.1,60.4],
				[2200,247.5,165.0,61.1],
				[2225,250.3,166.9,61.8],
				[2250,253.1,168.8,62.5],
				[2275,255.9,170.6,63.2],
				[2300,258.8,172.5,63.9],
				[2325,261.6,174.4,64.6],
				[2350,264.4,176.3,65.3],
				[2375,267.2,178.1,66.0],
				[2400,270.0,180.0,66.7],
				[2425,272.8,181.9,67.4],
				[2450,275.6,183.8,68.1],
				[2475,278.4,185.6,68.8],
				[2500,281.3,187.5,69.4],
				[2525,284.1,189.4,70.1],
				[2550,286.9,191.3,70.8],
				[2575,289.7,193.1,71.5],
				[2600,292.5,195.0,72.2],
				[2625,295.3,196.9,72.9],
				[2650,298.1,198.8,73.6],
				[2675,300.9,200.6,74.3],
				[2700,303.8,202.5,75.0],
				[2725,306.6,204.4,75.7],
				[2750,309.4,206.3,76.4],
				[2775,312.2,208.1,77.1],
				[2800,315.0,210.0,77.8],
				[2825,317.8,211.9,78.5],
				[2850,320.6,213.8,79.2],
				[2875,323.4,215.6,79.9],
				[2900,326.3,217.5,80.6],
				[2925,329.1,219.4,81.3],
				[2950,331.9,221.3,81.9],
				[2975,334.7,223.1,82.6],
				[3000,337.5,225.0,83.3],
				[3025,340.3,226.9,84.0],
				[3050,343.1,228.8,84.7],
				[3075,345.9,230.6,85.4],
				[3100,348.8,232.5,86.1],
				[3125,351.6,234.4,86.8],
				[3150,354.4,236.3,87.5],
				[3175,357.2,238.1,88.2],
				[3200,360.0,240.0,88.9],
				[3225,362.8,241.9,89.6],
				[3250,365.6,243.8,90.3],
				[3275,368.4,245.6,91.0],
				[3300,371.3,247.5,91.7],
				[3325,374.1,249.4,92.4],
				[3350,376.9,251.3,93.1],
				[3375,379.7,253.1,93.8],
				[3400,382.5,255.0,94.4],
				[3425,385.3,256.9,95.1],
				[3450,388.1,258.8,95.8],
				[3475,390.9,260.6,96.5],
				[3500,393.8,262.5,97.2],
				[3525,396.6,264.4,97.9],
				[3550,399.4,266.3,98.6],
				[3575,402.2,268.1,99.3],
				[3600,405.0,270.0,100.0],
				[3625,407.8,271.9,100.7],
				[3650,410.6,273.8,101.4],
				[3675,413.4,275.6,102.1],
				[3700,416.3,277.5,102.8],
				[3725,419.1,279.4,103.5],
				[3750,421.9,281.3,104.2],
				[3775,424.7,283.1,104.9],
				[3800,427.5,285.0,105.6],
				[3825,430.3,286.9,106.3],
				[3850,433.1,288.8,106.9],
				[3875,435.9,290.6,107.6],
				[3900,438.8,292.5,108.3],
				[3925,441.6,294.4,109.0],
				[3950,444.4,296.3,109.7],
				[3975,447.2,298.1,110.4],
				[4000,450.0,300.0,111.1],
				[4025,452.8,301.9,111.8]
			];
			break;
		case 'recomp':
			mac_tab = [
				[900,101.3,78.8,20.0],
				[925,104.1,80.9,20.6],
				[950,106.9,83.1,21.1],
				[975,109.7,85.3,21.7],
				[1000,112.5,87.5,22.2],
				[1025,115.3,89.7,22.8],
				[1050,118.1,91.9,23.3],
				[1075,120.9,94.1,23.9],
				[1100,123.8,96.3,24.4],
				[1125,126.6,98.4,25.0],
				[1150,129.4,100.6,25.6],
				[1175,132.2,102.8,26.1],
				[1200,135.0,105.0,26.7],
				[1225,137.8,107.2,27.2],
				[1250,140.6,109.4,27.8],
				[1275,143.4,111.6,28.3],
				[1300,146.3,113.8,28.9],
				[1325,149.1,115.9,29.4],
				[1350,151.9,118.1,30.0],
				[1375,154.7,120.3,30.6],
				[1400,157.5,122.5,31.1],
				[1425,160.3,124.7,31.7],
				[1450,163.1,126.9,32.2],
				[1475,165.9,129.1,32.8],
				[1500,168.8,131.3,33.3],
				[1525,171.6,133.4,33.9],
				[1550,174.4,135.6,34.4],
				[1575,177.2,137.8,35.0],
				[1600,180.0,140.0,35.6],
				[1625,182.8,142.2,36.1],
				[1650,185.6,144.4,36.7],
				[1675,188.4,146.6,37.2],
				[1700,191.3,148.8,37.8],
				[1725,194.1,150.9,38.3],
				[1750,196.9,153.1,38.9],
				[1775,199.7,155.3,39.4],
				[1800,202.5,157.5,40.0],
				[1825,205.3,159.7,40.6],
				[1850,208.1,161.9,41.1],
				[1875,210.9,164.1,41.7],
				[1900,213.8,166.3,42.2],
				[1925,216.6,168.4,42.8],
				[1950,219.4,170.6,43.3],
				[1975,222.2,172.8,43.9],
				[2000,225.0,175.0,44.4],
				[2025,227.8,177.2,45.0],
				[2050,230.6,179.4,45.6],
				[2075,233.4,181.6,46.1],
				[2100,236.3,183.8,46.7],
				[2125,239.1,185.9,47.2],
				[2150,241.9,188.1,47.8],
				[2175,244.7,190.3,48.3],
				[2200,247.5,192.5,48.9],
				[2225,250.3,194.7,49.4],
				[2250,253.1,196.9,50.0],
				[2275,255.9,199.1,50.6],
				[2300,258.8,201.3,51.1],
				[2325,261.6,203.4,51.7],
				[2350,264.4,205.6,52.2],
				[2375,267.2,207.8,52.8],
				[2400,270.0,210.0,53.3],
				[2425,272.8,212.2,53.9],
				[2450,275.6,214.4,54.4],
				[2475,278.4,216.6,55.0],
				[2500,281.3,218.8,55.6],
				[2525,284.1,220.9,56.1],
				[2550,286.9,223.1,56.7],
				[2575,289.7,225.3,57.2],
				[2600,292.5,227.5,57.8],
				[2625,295.3,229.7,58.3],
				[2650,298.1,231.9,58.9],
				[2675,300.9,234.1,59.4],
				[2700,303.8,236.3,60.0],
				[2725,306.6,238.4,60.6],
				[2750,309.4,240.6,61.1],
				[2775,312.2,242.8,61.7],
				[2800,315.0,245.0,62.2],
				[2825,317.8,247.2,62.8],
				[2850,320.6,249.4,63.3],
				[2875,323.4,251.6,63.9],
				[2900,326.3,253.8,64.4],
				[2925,329.1,255.9,65.0],
				[2950,331.9,258.1,65.6],
				[2975,334.7,260.3,66.1],
				[3000,337.5,262.5,66.7],
				[3025,340.3,264.7,67.2],
				[3050,343.1,266.9,67.8],
				[3075,345.9,269.1,68.3],
				[3100,348.8,271.3,68.9],
				[3125,351.6,273.4,69.4],
				[3150,354.4,275.6,70.0],
				[3175,357.2,277.8,70.6],
				[3200,360.0,280.0,71.1],
				[3225,362.8,282.2,71.7],
				[3250,365.6,284.4,72.2],
				[3275,368.4,286.6,72.8],
				[3300,371.3,288.8,73.3],
				[3325,374.1,290.9,73.9],
				[3350,376.9,293.1,74.4],
				[3375,379.7,295.3,75.0],
				[3400,382.5,297.5,75.6],
				[3425,385.3,299.7,76.1],
				[3450,388.1,301.9,76.7],
				[3475,390.9,304.1,77.2],
				[3500,393.8,306.3,77.8],
				[3525,396.6,308.4,78.3],
				[3550,399.4,310.6,78.9],
				[3575,402.2,312.8,79.4],
				[3600,405.0,315.0,80.0],
				[3625,407.8,317.2,80.6],
				[3650,410.6,319.4,81.1],
				[3675,413.4,321.6,81.7],
				[3700,416.3,323.8,82.2],
				[3725,419.1,325.9,82.8],
				[3750,421.9,328.1,83.3],
				[3775,424.7,330.3,83.9],
				[3800,427.5,332.5,84.4],
				[3825,430.3,334.7,85.0],
				[3850,433.1,336.9,85.6],
				[3875,435.9,339.1,86.1],
				[3900,438.8,341.3,86.7],
				[3925,441.6,343.4,87.2],
				[3950,444.4,345.6,87.8],
				[3975,447.2,347.8,88.3],
				[4000,450.0,350.0,88.9],
				[4025,452.8,352.2,89.4]
			];
			break;
		case 'build':
			mac_tab = [
				[900,90,90,20.00],
				[925,92.5,92.5,20.56],
				[950,95,95,21.11],
				[975,97.5,97.5,21.67],
				[1000,100,100,22.22],
				[1025,102.5,102.5,22.78],
				[1050,105,105,23.33],
				[1075,107.5,107.5,23.89],
				[1100,110,110,24.44],
				[1125,112.5,112.5,25.00],
				[1150,115,115,25.56],
				[1175,117.5,117.5,26.11],
				[1200,120,120,26.67],
				[1225,122.5,122.5,27.22],
				[1250,125,125,27.78],
				[1275,127.5,127.5,28.33],
				[1300,130,130,28.89],
				[1325,132.5,132.5,29.44],
				[1350,135,135,30.00],
				[1375,137.5,137.5,30.56],
				[1400,140,140,31.11],
				[1425,142.5,142.5,31.67],
				[1450,145,145,32.22],
				[1475,147.5,147.5,32.78],
				[1500,150,150,33.33],
				[1525,152.5,152.5,33.89],
				[1550,155,155,34.44],
				[1575,157.5,157.5,35.00],
				[1600,160,160,35.56],
				[1625,162.5,162.5,36.11],
				[1650,165,165,36.67],
				[1675,167.5,167.5,37.22],
				[1700,170,170,37.78],
				[1725,172.5,172.5,38.33],
				[1750,175,175,38.89],
				[1775,177.5,177.5,39.44],
				[1800,180,180,40.00],
				[1825,182.5,182.5,40.56],
				[1850,185,185,41.11],
				[1875,187.5,187.5,41.67],
				[1900,190,190,42.22],
				[1925,192.5,192.5,42.78],
				[1950,195,195,43.33],
				[1975,197.5,197.5,43.89],
				[2000,200,200,44.44],
				[2025,202.5,202.5,45.00],
				[2050,205,205,45.56],
				[2075,207.5,207.5,46.11],
				[2100,210,210,46.67],
				[2125,212.5,212.5,47.22],
				[2150,215,215,47.78],
				[2175,217.5,217.5,48.33],
				[2200,220,220,48.89],
				[2225,222.5,222.5,49.44],
				[2250,225,225,50.00],
				[2275,227.5,227.5,50.56],
				[2300,230,230,51.11],
				[2325,232.5,232.5,51.67],
				[2350,235,235,52.22],
				[2375,237.5,237.5,52.78],
				[2400,240,240,53.33],
				[2425,242.5,242.5,53.89],
				[2450,245,245,54.44],
				[2475,247.5,247.5,55.0],
				[2500,250,250,55.6],
				[2525,252.5,252.5,56.1],
				[2550,255,255,56.7],
				[2575,257.5,257.5,57.2],
				[2600,260,260,57.8],
				[2625,262.5,262.5,58.3],
				[2650,265,265,58.9],
				[2675,267.5,267.5,59.4],
				[2700,270,270,60.0],
				[2725,272.5,272.5,60.6],
				[2750,275,275,61.1],
				[2775,277.5,277.5,61.7],
				[2800,280,280,62.2],
				[2825,282.5,282.5,62.8],
				[2850,285,285,63.3],
				[2875,287.5,287.5,63.9],
				[2900,290,290,64.4],
				[2925,292.5,292.5,65.0],
				[2950,295,295,65.6],
				[2975,297.5,297.5,66.1],
				[3000,300,300,66.7],
				[3025,302.5,302.5,67.2],
				[3050,305,305,67.8],
				[3075,307.5,307.5,68.3],
				[3100,310,310,68.9],
				[3125,312.5,312.5,69.4],
				[3150,315,315,70.0],
				[3175,317.5,317.5,70.6],
				[3200,320,320,71.1],
				[3225,322.5,322.5,71.7],
				[3250,325,325,72.2],
				[3275,327.5,327.5,72.8],
				[3300,330,330,73.3],
				[3325,332.5,332.5,73.9],
				[3350,335,335,74.4],
				[3375,337.5,337.5,75.0],
				[3400,340,340,75.6],
				[3425,342.5,342.5,76.1],
				[3450,345,345,76.7],
				[3475,347.5,347.5,77.2],
				[3500,350,350,77.8],
				[3525,352.5,352.5,78.3],
				[3550,355,355,78.9],
				[3575,357.5,357.5,79.4],
				[3600,360,360,80.0],
				[3625,362.5,362.5,80.6],
				[3650,365,365,81.1],
				[3675,367.5,367.5,81.7],
				[3700,370,370,82.2],
				[3725,372.5,372.5,82.8],
				[3750,375,375,83.3],
				[3775,377.5,377.5,83.9],
				[3800,380,380,84.4],
				[3825,382.5,382.5,85.0],
				[3850,385,385,85.6],
				[3875,387.5,387.5,86.1],
				[3900,390,390,86.7],
				[3925,392.5,392.5,87.2],
				[3950,395,395,87.8],
				[3975,397.5,397.5,88.3],
				[4000,400,400,88.9],
				[4025,402.5,402.5,89.4]
			];
			break;
	}
	
	if(!mac_tab) return false;
	
	const getClosestIndex = (needle, haystack) => haystack.reduce((acc, curr, idx, arr) => {
		if(curr === null) return acc;
		if(acc === null) return idx;
		var closest_val_diff = Math.abs(arr[acc] - needle);
		var curr_val_diff = Math.abs(curr - needle);
		return closest_val_diff < curr_val_diff ? acc : idx;
	}, null);
	
	var cals = mac_tab.map(a=>a[0]);

	var y = getClosestIndex(calories, cals);
	
	var [cals, protein, carbs, fats] = mac_tab[y];
	
	return {protein, carbs, fats};
}

async function getExercises(){
	return await fetch('exercises.json').then(j=>j.json());
}